% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrartcl}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
% Make \paragraph and \subparagraph free-standing
\makeatletter
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}{
    \@ifstar
      \xxxParagraphStar
      \xxxParagraphNoStar
  }
  \newcommand{\xxxParagraphStar}[1]{\oldparagraph*{#1}\mbox{}}
  \newcommand{\xxxParagraphNoStar}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}{
    \@ifstar
      \xxxSubParagraphStar
      \xxxSubParagraphNoStar
  }
  \newcommand{\xxxSubParagraphStar}[1]{\oldsubparagraph*{#1}\mbox{}}
  \newcommand{\xxxSubParagraphNoStar}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
\makeatother

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\usepackage{fvextra}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
\KOMAoption{captions}{tableheading}
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother

\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage{bookmark}

\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={PS4 Andy Fan Will Sigal},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}


\title{PS4 Andy Fan Will Sigal}
\author{}
\date{}

\begin{document}
\maketitle

\RecustomVerbatimEnvironment{verbatim}{Verbatim}{
  showspaces = false,
  showtabs = false,
  breaksymbolleft={},
  breaklines
}


\textbf{PS4:} Due Sat Nov 2 at 5:00PM Central. Worth 100 points.

\subsection{Style Points (10 pts)}\label{style-points-10-pts}

\subsection{Submission Steps (10 pts)}\label{submission-steps-10-pts}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  This problem set is a paired problem set.
\item
  Play paper, scissors, rock to determine who goes first. Call that
  person \emph{Partner 1}.

  \begin{itemize}
  \tightlist
  \item
    Partner 1 (name and cnet ID): Andy Fan, fanx
  \item
    Partner 2 (name and cnet ID):
  \end{itemize}
\item
  Partner 1 will accept the \texttt{ps4} and then share the link it
  creates with their partner. You can only share it with one partner so
  you will not be able to change it after your partner has accepted.
\item
  ``This submission is our work alone and complies with the 30538
  integrity policy.'' Add your initials to indicate your agreement:
\end{enumerate}

AF WS

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  ``I have uploaded the names of anyone else other than my partner and I
  worked with on the problem set
  \textbf{\href{https://docs.google.com/forms/d/185usrCREQaUbvAXpWhChkjghdGgmAZXA3lPWpXLLsts/edit}{here}}''
  (1 point)
\item
  Late coins used this pset: (Andy:0); (Will:0) Late coins left after
  submission: (Andy: 3) ; (Will: 4)
\item
  Knit your \texttt{ps4.qmd} to an PDF file to make \texttt{ps4.pdf},

  \begin{itemize}
  \tightlist
  \item
    The PDF should not be more than 25 pages. Use \texttt{head()} and
    re-size figures when appropriate.
  \end{itemize}
\item
  (Partner 1): push \texttt{ps4.qmd} and \texttt{ps4.pdf} to your github
  repo.
\item
  (Partner 1): submit \texttt{ps4.pdf} via Gradescope. Add your partner
  on Gradescope.
\item
  (Partner 1): tag your submission in Gradescope
\end{enumerate}

\textbf{Important:} Repositories are for tracking code. \textbf{Do not
commit the data or shapefiles to your repo.} The best way to do this is
with \texttt{.gitignore}, which we have covered in class. If you do
accidentally commit the data, Github has a
\href{https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-large-files-on-github\#removing-files-from-a-repositorys-history}{guide}.
The best course of action depends on whether you have pushed yet. This
also means that both partners will have to download the initial raw data
and any data cleaning code will need to be re-run on both partners'
computers.

\subsection{Download and explore the Provider of Services (POS) file (10
pts)}\label{download-and-explore-the-provider-of-services-pos-file-10-pts}

(This file records all providers certified to bill Medicare and
Medicaid. Each provider has a unique CMS certification number,
consistent across different years)

(The data dictionary is located at the bottom of the page as ``Provider
of Services File- Hospital \& Non-Hospital Facilities Data Dictionary)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# SETUP }
\ImportTok{import}\NormalTok{ pandas }\ImportTok{as}\NormalTok{ pd}
\ImportTok{import}\NormalTok{ altair }\ImportTok{as}\NormalTok{ alt}
\ImportTok{import}\NormalTok{ time}
\ImportTok{import}\NormalTok{ os}
\ImportTok{import}\NormalTok{ warnings}
\ImportTok{import}\NormalTok{ geopandas }\ImportTok{as}\NormalTok{ gpd}
\NormalTok{warnings.filterwarnings(}\StringTok{\textquotesingle{}ignore\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\paragraph{1. (Partner 1) This is a fairly large dataset and we won't be
using most of the variables. Read through the rest of the problem set
and look through the data dictionary to identify which variables you
will need to complete the exercise, and use the tool on data.cms.gov
into restrict to those variables (``Manage Columns'') before exporting
(``Export''). Download this for 2016 and call it pos2016.csv. What are
the variables you
pulled?}\label{partner-1-this-is-a-fairly-large-dataset-and-we-wont-be-using-most-of-the-variables.-read-through-the-rest-of-the-problem-set-and-look-through-the-data-dictionary-to-identify-which-variables-you-will-need-to-complete-the-exercise-and-use-the-tool-on-data.cms.gov-into-restrict-to-those-variables-manage-columns-before-exporting-export.-download-this-for-2016-and-call-it-pos2016.csv.-what-are-the-variables-you-pulled}

required variables:

provider type code: PRVDR\_CTGRY\_CD

subtype code: PRVDR\_CTGRY\_SBTYP\_CD

CMS certification number: PRVDR\_NUM

Termination code: PGM\_TRMNTN\_CD

zip code: ZIP\_CD

Date of termination: TRMNTN\_EXPRTN\_DT

Facility name: FAC\_NAME

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# import data (default directory is just the repo)}

\CommentTok{\#os.chdir(\textquotesingle{}/Users/willsigal/Documents/GitHub/problem{-}set{-}4{-}andy{-}fan{-}will{-}sigal/Data\textquotesingle{}) \#will wd}

\NormalTok{os.chdir(}\StringTok{\textquotesingle{}d:}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{UChicago}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{Classes}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{2024Qfall}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{Programming Python}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{problem{-}set{-}4{-}andy{-}fan{-}will{-}sigal}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{Data\textquotesingle{}}\NormalTok{) }\CommentTok{\#andy wd}

\NormalTok{df\_2016 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}pos2016.csv\textquotesingle{}}\NormalTok{, encoding}\OperatorTok{=}\StringTok{"latin1"}\NormalTok{, on\_bad\_lines}\OperatorTok{=}\StringTok{"skip"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\paragraph{2. (Partner 1) Import your pos2016.csv file. We want to focus
on short-term hospitals. These are identified as facilities with
provider type code 01 and subtype code 01. Subset your data to these
facilities. How many hospitals are reported in this data? Does this
number make sense? Cross-reference with other sources and cite the
number you compared it to. If it differs, why do you think it could
differ?}\label{partner-1-import-your-pos2016.csv-file.-we-want-to-focus-on-short-term-hospitals.-these-are-identified-as-facilities-with-provider-type-code-01-and-subtype-code-01.-subset-your-data-to-these-facilities.-how-many-hospitals-are-reported-in-this-data-does-this-number-make-sense-cross-reference-with-other-sources-and-cite-the-number-you-compared-it-to.-if-it-differs-why-do-you-think-it-could-differ}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#subset to short term hositals}
\NormalTok{df\_2016 }\OperatorTok{=}\NormalTok{ df\_2016[(df\_2016[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df\_2016[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
a.There are 7275 short term hospitals reported in the data. This number at a glance makes sense nationwide.

b.Looking at the Article by Jane Wishner, Patricia Solleveld, Robin Rudowitz, Julia Paradise, and Larisa Antonisse, they found "nearly 5,000 short-term, acute care hospitals in the United States". This is less than the data we have. It is possibly because some of the short-term hospitals in our dataset closed (they are temporary after all, and could have only been setup for less than a year)
\end{verbatim}

\paragraph{3. (Partner 1) Repeat the previous 3 steps with 2017Q4,
2018Q4, and 2019Q4 and then append them together. Plot the number of
observations in your dataset by
year.}\label{partner-1-repeat-the-previous-3-steps-with-2017q4-2018q4-and-2019q4-and-then-append-them-together.-plot-the-number-of-observations-in-your-dataset-by-year.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# import data }
\NormalTok{df\_2017 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}pos2017.csv\textquotesingle{}}\NormalTok{, encoding}\OperatorTok{=}\StringTok{"latin1"}\NormalTok{, on\_bad\_lines}\OperatorTok{=}\StringTok{"skip"}\NormalTok{)}
\NormalTok{df\_2018 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}pos2018.csv\textquotesingle{}}\NormalTok{, encoding}\OperatorTok{=}\StringTok{"latin1"}\NormalTok{, on\_bad\_lines}\OperatorTok{=}\StringTok{"skip"}\NormalTok{)}
\NormalTok{df\_2019 }\OperatorTok{=}\NormalTok{ pd.read\_csv(}\StringTok{\textquotesingle{}pos2019.csv\textquotesingle{}}\NormalTok{, encoding}\OperatorTok{=}\StringTok{"latin1"}\NormalTok{, on\_bad\_lines}\OperatorTok{=}\StringTok{"skip"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#subset to short term hositals}
\NormalTok{df\_2017 }\OperatorTok{=}\NormalTok{ df\_2017[(df\_2017[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df\_2017[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}
\NormalTok{df\_2018 }\OperatorTok{=}\NormalTok{ df\_2018[(df\_2018[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df\_2018[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}
\NormalTok{df\_2019 }\OperatorTok{=}\NormalTok{ df\_2019[(df\_2019[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_SBTYP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df\_2019[}\StringTok{\textquotesingle{}PRVDR\_CTGRY\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{1}\NormalTok{)]}
\end{Highlighting}
\end{Shaded}

The number of short-term hospitals in each of the years:

2017: 7260 hospitals

2018: 7277 hospitals

2019: 7303 hospitals

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# create new year columns}
\NormalTok{df\_2016[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2016}
\NormalTok{df\_2017[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2017}
\NormalTok{df\_2018[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2018}
\NormalTok{df\_2019[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{] }\OperatorTok{=} \DecValTok{2019}

\CommentTok{\#\#\# append}
\NormalTok{df }\OperatorTok{=}\NormalTok{ pd.concat([df\_2016, df\_2017, df\_2018, df\_2019], ignore\_index}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# altair plot}
\NormalTok{df1\_3 }\OperatorTok{=}\NormalTok{ df.groupby(}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{).size().reset\_index(name}\OperatorTok{=}\StringTok{\textquotesingle{}count\textquotesingle{}}\NormalTok{)}

\NormalTok{chartQ1\_3 }\OperatorTok{=}\NormalTok{ alt.Chart(df1\_3).mark\_bar().encode(}
\NormalTok{    x}\OperatorTok{=}\NormalTok{ alt.X(}\StringTok{\textquotesingle{}year:O\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\NormalTok{alt.Axis(labelAngle}\OperatorTok{=}\DecValTok{90}\NormalTok{)),}
\NormalTok{    y}\OperatorTok{=}\NormalTok{ alt.Y(}\StringTok{\textquotesingle{}count:Q\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{\textquotesingle{}number of hospitals\textquotesingle{}}\NormalTok{, scale}\OperatorTok{=}\NormalTok{alt.Scale(domain}\OperatorTok{=}\NormalTok{[}\DecValTok{7000}\NormalTok{, }\DecValTok{7500}\NormalTok{], clamp}\OperatorTok{=}\VariableTok{True}\NormalTok{))}
\NormalTok{).properties(}
\NormalTok{    width}\OperatorTok{=}\DecValTok{400}\NormalTok{, }
\NormalTok{    height}\OperatorTok{=}\DecValTok{200}\NormalTok{, }
\NormalTok{    title}\OperatorTok{=}\StringTok{\textquotesingle{}Observations of Hospitals by Year\textquotesingle{}}  
\NormalTok{)}
\NormalTok{chartQ1\_3.save(}\StringTok{"chartQ1\_3.png"}\NormalTok{)}
\NormalTok{chartQ1\_3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
alt.Chart(...)
\end{verbatim}

\begin{figure}[H]

{\centering \includegraphics{chartQ1_3.png}

}

\caption{Chart Q1.3}

\end{figure}%

\paragraph{4. (Partner 1) Each hospital is identified by its CMS
certification number. Plot the number of unique hospitals in your
dataset per year. Compare this to your plot in the previous step. What
does this tell you about the structure of the
data?}\label{partner-1-each-hospital-is-identified-by-its-cms-certification-number.-plot-the-number-of-unique-hospitals-in-your-dataset-per-year.-compare-this-to-your-plot-in-the-previous-step.-what-does-this-tell-you-about-the-structure-of-the-data}

\begin{verbatim}
a.plot unique hospitals
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# plot}
\NormalTok{df1\_4 }\OperatorTok{=}\NormalTok{ df.groupby(}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{)[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{].nunique().reset\_index()}

\NormalTok{chartQ1\_4 }\OperatorTok{=}\NormalTok{ alt.Chart(df1\_4).mark\_bar().encode(}
\NormalTok{    x}\OperatorTok{=}\NormalTok{ alt.X(}\StringTok{\textquotesingle{}year:O\textquotesingle{}}\NormalTok{, axis}\OperatorTok{=}\NormalTok{alt.Axis(labelAngle}\OperatorTok{=}\DecValTok{90}\NormalTok{)),}
\NormalTok{    y}\OperatorTok{=}\NormalTok{ alt.Y(}\StringTok{\textquotesingle{}PRVDR\_NUM:Q\textquotesingle{}}\NormalTok{, title}\OperatorTok{=}\StringTok{\textquotesingle{}number of unique hospitals\textquotesingle{}}\NormalTok{, scale}\OperatorTok{=}\NormalTok{alt.Scale(domain}\OperatorTok{=}\NormalTok{[}\DecValTok{7000}\NormalTok{, }\DecValTok{7500}\NormalTok{], clamp}\OperatorTok{=}\VariableTok{True}\NormalTok{))}
\NormalTok{).properties(}
\NormalTok{    width}\OperatorTok{=}\DecValTok{400}\NormalTok{, }
\NormalTok{    height}\OperatorTok{=}\DecValTok{200}\NormalTok{, }
\NormalTok{    title}\OperatorTok{=}\StringTok{\textquotesingle{}Unique Hospitals by Year\textquotesingle{}}  
\NormalTok{)}
\NormalTok{chartQ1\_4.save(}\StringTok{"chartQ1\_4.png"}\NormalTok{)}
\NormalTok{chartQ1\_4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
alt.Chart(...)
\end{verbatim}

\begin{figure}[H]

{\centering \includegraphics{chartQ1_4.png}

}

\caption{Chart Q1.4}

\end{figure}%

\begin{verbatim}
b.compare to previous step, what does this tell about data structure:
\end{verbatim}

The plots are identical. Which means each hospital is a unique
observation, tallied each year.

\subsection{Identify hospital closures in POS file (15 pts)
(*)}\label{identify-hospital-closures-in-pos-file-15-pts}

We will now use the 2016-2019 files to identify hospital closures
nationally. A hospital issuspected to have closed if its Termination
Code in the POS file lists them as an ``Active Provider'' in 2016 and
then they are either not active or do not appear in the data at all in a
subsequent year.

\paragraph{1. (Partner 2) Use this definition to create a list of all
hospitals that were active in 2016 that were suspected to have closed by
2019. Record the facility name and zip of each hospital as well as the
year of suspected closure (when they become terminated or disappear from
the data). How many hospitals are there that fit this
definition?}\label{partner-2-use-this-definition-to-create-a-list-of-all-hospitals-that-were-active-in-2016-that-were-suspected-to-have-closed-by-2019.-record-the-facility-name-and-zip-of-each-hospital-as-well-as-the-year-of-suspected-closure-when-they-become-terminated-or-disappear-from-the-data.-how-many-hospitals-are-there-that-fit-this-definition}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{active\_in\_2016 }\OperatorTok{=}\NormalTok{ df[(df[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{2016}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{)][[}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{]].copy()}

\NormalTok{last\_active\_years }\OperatorTok{=}\NormalTok{ df[df[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{].groupby(}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{)[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{].}\BuiltInTok{max}\NormalTok{().reset\_index(name}\OperatorTok{=}\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{)}

\NormalTok{active\_in\_2016 }\OperatorTok{=}\NormalTok{ active\_in\_2016.merge(last\_active\_years, on}\OperatorTok{=}\StringTok{\textquotesingle{}PRVDR\_NUM\textquotesingle{}}\NormalTok{, how}\OperatorTok{=}\StringTok{\textquotesingle{}left\textquotesingle{}}\NormalTok{)}

\NormalTok{active\_hospitals\_count }\OperatorTok{=}\NormalTok{ active\_in\_2016.shape[}\DecValTok{0}\NormalTok{]}

\NormalTok{suspected\_closures }\OperatorTok{=}\NormalTok{ active\_in\_2016[active\_in\_2016[}\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{] }\OperatorTok{\textless{}} \DecValTok{2019}\NormalTok{].copy()}

\NormalTok{closure\_count }\OperatorTok{=}\NormalTok{ suspected\_closures.shape[}\DecValTok{0}\NormalTok{]}
\NormalTok{suspected\_closures[[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{]], closure\_count}

\NormalTok{closure\_count}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
174
\end{verbatim}

\paragraph{2. (Partner 2) Sort this list of hospitals by name and report
the names and year of suspected closure for the first 10
rows.}\label{partner-2-sort-this-list-of-hospitals-by-name-and-report-the-names-and-year-of-suspected-closure-for-the-first-10-rows.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{first\_ten\_closures }\OperatorTok{=}\NormalTok{ suspected\_closures.sort\_values(by}\OperatorTok{=}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{).head(}\DecValTok{10}\NormalTok{)[[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{]]}

\NormalTok{first\_ten\_closures}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lll@{}}
\toprule\noalign{}
& FAC\_NAME & last\_active\_year \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
93 & ABRAZO MARYVALE CAMPUS & 2016 \\
299 & ADVENTIST MEDICAL CENTER - CENTRAL VALLEY & 2016 \\
2276 & AFFINITY MEDICAL CENTER & 2017 \\
2019 & ALBANY MEDICAL CENTER / SOUTH CLINICAL CAMPUS & 2016 \\
2955 & ALLEGIANCE SPECIALTY HOSPITAL OF KILGORE & 2016 \\
1682 & ALLIANCE LAIRD HOSPITAL & 2018 \\
2345 & ALLIANCEHEALTH DEACONESS & 2018 \\
720 & ANNE BATES LEACH EYE HOSPITAL & 2018 \\
528 & ARKANSAS VALLEY REGIONAL MEDICAL CENTER & 2016 \\
1801 & BANNER CHURCHILL COMMUNITY HOSPITAL & 2016 \\
\end{longtable}

\paragraph{3. (Partner 2) However, not all suspected hospital closures
are true closures. For example, in the case of a merger, a CMS
certification number will be appear to be ``terminated,'' but then the
hospital re-appear under a similar name/address with a new CMS certifi
cation number in the next year. As a first pass to address this, remove
any suspected hospital closures that are in zip codes where the number
of active hospitals does not decrease in the year after the suspected
closure.}\label{partner-2-however-not-all-suspected-hospital-closures-are-true-closures.-for-example-in-the-case-of-a-merger-a-cms-certification-number-will-be-appear-to-be-terminated-but-then-the-hospital-re-appear-under-a-similar-nameaddress-with-a-new-cms-certifi-cation-number-in-the-next-year.-as-a-first-pass-to-address-this-remove-any-suspected-hospital-closures-that-are-in-zip-codes-where-the-number-of-active-hospitals-does-not-decrease-in-the-year-after-the-suspected-closure.}

\begin{verbatim}
a. Among the suspected closures, how many hospitals fit this definition of potentially being a merger/acquisition?
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{active\_hospitals\_count }\OperatorTok{=}\NormalTok{ df[df[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{].groupby([}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{]).size().reset\_index(name}\OperatorTok{=}\StringTok{\textquotesingle{}active\_count\textquotesingle{}}\NormalTok{)}
\NormalTok{zip\_year\_counts }\OperatorTok{=}\NormalTok{ active\_hospitals\_count.pivot(index}\OperatorTok{=}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{, columns}\OperatorTok{=}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{, values}\OperatorTok{=}\StringTok{\textquotesingle{}active\_count\textquotesingle{}}\NormalTok{).fillna(}\DecValTok{0}\NormalTok{)}

\NormalTok{suspected\_closures[}\StringTok{\textquotesingle{}closure\_year\_count\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ suspected\_closures.}\BuiltInTok{apply}\NormalTok{(}
    \KeywordTok{lambda}\NormalTok{ row: zip\_year\_counts.at[row[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{], row[}\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{]] }\ControlFlowTok{if}\NormalTok{ row[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\KeywordTok{in}\NormalTok{ zip\_year\_counts.index }\ControlFlowTok{else} \DecValTok{0}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}
\NormalTok{)}
\NormalTok{suspected\_closures[}\StringTok{\textquotesingle{}next\_year\_count\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ suspected\_closures.}\BuiltInTok{apply}\NormalTok{(}
    \KeywordTok{lambda}\NormalTok{ row: zip\_year\_counts.at[row[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{], row[}\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{] }\OperatorTok{+} \DecValTok{1}\NormalTok{] }\ControlFlowTok{if}\NormalTok{ row[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\KeywordTok{in}\NormalTok{ zip\_year\_counts.index }\ControlFlowTok{else} \DecValTok{0}\NormalTok{, axis}\OperatorTok{=}\DecValTok{1}
\NormalTok{)}

\NormalTok{potential\_mergers }\OperatorTok{=}\NormalTok{ suspected\_closures[suspected\_closures[}\StringTok{\textquotesingle{}closure\_year\_count\textquotesingle{}}\NormalTok{] }\OperatorTok{\textless{}=}\NormalTok{ suspected\_closures[}\StringTok{\textquotesingle{}next\_year\_count\textquotesingle{}}\NormalTok{]]}

\NormalTok{merger\_count }\OperatorTok{=}\NormalTok{ potential\_mergers.shape[}\DecValTok{0}\NormalTok{]}

\NormalTok{merger\_count}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
8
\end{verbatim}

\begin{verbatim}
b. After correcting for this, how many hospitals do you have left?
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{true\_closures }\OperatorTok{=}\NormalTok{ suspected\_closures[suspected\_closures[}\StringTok{\textquotesingle{}closure\_year\_count\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}}\NormalTok{ suspected\_closures[}\StringTok{\textquotesingle{}next\_year\_count\textquotesingle{}}\NormalTok{]]}

\NormalTok{remaining\_closures\_count }\OperatorTok{=}\NormalTok{ true\_closures.shape[}\DecValTok{0}\NormalTok{]}

\NormalTok{remaining\_closures\_count}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
166
\end{verbatim}

\begin{verbatim}
c. Sort this list of corrected hospital closures by name and report the first 10 rows.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{correct\_closure\_df }\OperatorTok{=}\NormalTok{ true\_closures.sort\_values(by}\OperatorTok{=}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{).head(}\DecValTok{10}\NormalTok{)[[}\StringTok{\textquotesingle{}FAC\_NAME\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}last\_active\_year\textquotesingle{}}\NormalTok{]]}

\NormalTok{correct\_closure\_df.head(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llll@{}}
\toprule\noalign{}
& FAC\_NAME & ZIP\_CD & last\_active\_year \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
93 & ABRAZO MARYVALE CAMPUS & 85031.0 & 2016 \\
299 & ADVENTIST MEDICAL CENTER - CENTRAL VALLEY & 93230.0 & 2016 \\
2276 & AFFINITY MEDICAL CENTER & 44646.0 & 2017 \\
2019 & ALBANY MEDICAL CENTER / SOUTH CLINICAL CAMPUS & 12208.0 & 2016 \\
2955 & ALLEGIANCE SPECIALTY HOSPITAL OF KILGORE & 75662.0 & 2016 \\
1682 & ALLIANCE LAIRD HOSPITAL & 39365.0 & 2018 \\
2345 & ALLIANCEHEALTH DEACONESS & 73112.0 & 2018 \\
720 & ANNE BATES LEACH EYE HOSPITAL & 33136.0 & 2018 \\
528 & ARKANSAS VALLEY REGIONAL MEDICAL CENTER & 81050.0 & 2016 \\
1801 & BANNER CHURCHILL COMMUNITY HOSPITAL & 89406.0 & 2016 \\
\end{longtable}

\subsection{Download Census zip code shapefile (10
pt)}\label{download-census-zip-code-shapefile-10-pt}

Navigate to the Census shapefiles (link), select
``gz\_2010\_us\_860\_00\_500k.zip'' and download the resulting
shapefile. Note: If you have difficulty downloading or working with the
file because the size is too large for your computer, reach out to the
instruction team on Ed so that we can give them a smaller initial
shapefile to work with.

\paragraph{1. (Partner 1) This is non-tabular data. 1a. What are the
five file types and what type of information is in each file? 1b. It
will be useful going forward to have a sense going forward of which
files are big versus small. After unzipping, how big is each of the
datasets?}\label{partner-1-this-is-non-tabular-data.-1a.-what-are-the-five-file-types-and-what-type-of-information-is-in-each-file-1b.-it-will-be-useful-going-forward-to-have-a-sense-going-forward-of-which-files-are-big-versus-small.-after-unzipping-how-big-is-each-of-the-datasets}

\begin{verbatim}
a.The 5 file types are: 
1.dbf file--which is a table that stores attributes of the geometries. 
2.prj file--stores the coordinate system information; used by ArcGIS.
3.shp file--The main file that stores the feature geometry (by far the largest, >800mb in this instance)
4.shx file--the index file for the geometries
5.xml file--is metadata for ArcGIS that has info about the shapefile itself

b. The size of the files:
1.dbf file--6275kb
2.prj file--1kb
3.shp file--817,915kb
4.shx file--259kb
5.xml file--16kb
\end{verbatim}

\paragraph{2. (Partner 1) Load the zip code shapefile and restrict to
Texas zip codes. (Hint: you can identify which state a zip code is in
using the first 2-3 numbers in the zip code (Wikipedia link). Then
calculate the number of hospitals per zip code in 2016 based on the
cleaned POS file from the previous step. Plot a choropleth of the number
of hospitals by zip code in
Texas.}\label{partner-1-load-the-zip-code-shapefile-and-restrict-to-texas-zip-codes.-hint-you-can-identify-which-state-a-zip-code-is-in-using-the-first-2-3-numbers-in-the-zip-code-wikipedia-link.-then-calculate-the-number-of-hospitals-per-zip-code-in-2016-based-on-the-cleaned-pos-file-from-the-previous-step.-plot-a-choropleth-of-the-number-of-hospitals-by-zip-code-in-texas.}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ geopandas }\ImportTok{as}\NormalTok{ gpd}
\CommentTok{\#os.chdir(\textquotesingle{}/Users/willsigal/Documents/GitHub/problem{-}set{-}4{-}andy{-}fan{-}will{-}sigal/Shapefiles\textquotesingle{}) \#will wd shapefiles}

\NormalTok{os.chdir(}\StringTok{\textquotesingle{}d:}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{UChicago}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{Classes}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{2024Qfall}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{Programming Python}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{problem{-}set{-}4{-}andy{-}fan{-}will{-}sigal}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{Shapefiles\textquotesingle{}}\NormalTok{) }\CommentTok{\#andy wd shapefiles}

\NormalTok{zips\_all }\OperatorTok{=}\NormalTok{ gpd.read\_file(}\StringTok{\textquotesingle{}gz\_2010\_us\_860\_00\_500k.shp\textquotesingle{}}\NormalTok{)}
\NormalTok{gpd\_texas }\OperatorTok{=}\NormalTok{ pd.DataFrame(zips\_all)}
\CommentTok{\#texas zips: 75xxx{-}79xxx, 885xx, (also 73301 but for IRS only)}
\NormalTok{gpd\_texas }\OperatorTok{=}\NormalTok{ gpd\_texas[gpd\_texas[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].}\BuiltInTok{str}\NormalTok{.startswith((}\StringTok{\textquotesingle{}75\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}76\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}77\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}78\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}79\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}885\textquotesingle{}}\NormalTok{))]}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\# number of hospitals per zip:}
\NormalTok{df\_2016\_tx }\OperatorTok{=}\NormalTok{ df\_2016}
\NormalTok{df\_2016\_tx[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df\_2016\_tx[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].astype(}\BuiltInTok{int}\NormalTok{)}
\NormalTok{df\_2016\_tx[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df\_2016\_tx[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].astype(}\BuiltInTok{str}\NormalTok{)}
\NormalTok{df\_2016\_tx }\OperatorTok{=}\NormalTok{ df\_2016\_tx[df\_2016\_tx[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].isin(gpd\_texas[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{])]}

\NormalTok{tx\_zip }\OperatorTok{=}\NormalTok{ df\_2016\_tx[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].value\_counts().reindex(gpd\_texas[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{]).fillna(}\DecValTok{0}\NormalTok{).astype(}\BuiltInTok{int}\NormalTok{)}
\NormalTok{tx\_zip }\OperatorTok{=}\NormalTok{ tx\_zip.reset\_index()}

\CommentTok{\#asked chatgpt how to find the number of observations for each zip code in df1 using observations from df2}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#\#\#Plot a choropleth of the number of hospitals by zip code in Texas.}
\CommentTok{\#append count to gpd}
\NormalTok{zips\_texas }\OperatorTok{=}\NormalTok{ zips\_all[zips\_all[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].}\BuiltInTok{str}\NormalTok{.startswith((}\StringTok{\textquotesingle{}75\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}76\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}77\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}78\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}79\textquotesingle{}}\NormalTok{,}\StringTok{\textquotesingle{}885\textquotesingle{}}\NormalTok{))]}
\NormalTok{zips\_texas }\OperatorTok{=}\NormalTok{ pd.merge(zips\_texas, tx\_zip, on}\OperatorTok{=}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{, how}\OperatorTok{=}\StringTok{\textquotesingle{}left\textquotesingle{}}\NormalTok{)}

\CommentTok{\#create area column in km2}
\NormalTok{zips\_texas[}\StringTok{"area\_km2"}\NormalTok{] }\OperatorTok{=}\NormalTok{ zips\_texas.area }\OperatorTok{/} \DecValTok{1000000} 
\NormalTok{zips\_texas[[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}count\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}area\_km2\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}geometry\textquotesingle{}}\NormalTok{]].head()}

\NormalTok{zips\_texas.plot(column}\OperatorTok{=}\StringTok{"count"}\NormalTok{, legend}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\includegraphics{ps4_files/figure-pdf/cell-17-output-1.pdf}

*ZCTA5 is the Census 5 digit zip code tabulation area, and will be
considered the zip code as no other variable is avaliable.

\subsection{Calculate zip code's distance to the nearest hospital (20
pts)
(*)}\label{calculate-zip-codes-distance-to-the-nearest-hospital-20-pts}

\paragraph{1. (Partner 2) Create a GeoDataFrame for the centroid of each
zip code nationally: zips\_all\_centroids. What are the dimensions of
the resulting GeoDataFrame and what do each of the columns
mean?}\label{partner-2-create-a-geodataframe-for-the-centroid-of-each-zip-code-nationally-zips_all_centroids.-what-are-the-dimensions-of-the-resulting-geodataframe-and-what-do-each-of-the-columns-mean}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zips\_all\_centroids }\OperatorTok{=}\NormalTok{ zips\_all}
\NormalTok{zips\_all\_centroids[}\StringTok{\textquotesingle{}geometry\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ zips\_all[}\StringTok{\textquotesingle{}geometry\textquotesingle{}}\NormalTok{].centroid}
\NormalTok{zips\_all\_centroids.shape}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(33120, 6)
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zips\_all\_centroids.columns}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Index(['GEO_ID', 'ZCTA5', 'NAME', 'LSAD', 'CENSUSAREA', 'geometry'], dtype='object')
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zips\_all\_centroids.plot()}
\end{Highlighting}
\end{Shaded}

\includegraphics{ps4_files/figure-pdf/cell-20-output-1.pdf}

Geo\_id is the unique identifier, ZCTA5 is the xip code, Name is the
name of the area, censusarea is the area of the zcta in square
kilometers and geometry is the centroid point geomotry for each ZCTA.

\paragraph{2. (Partner 2) Create two GeoDataFrames as subsets of
zips\_all\_centroids. First, create all zip codes in Texas:
zips\_texas\_centroids. Then, create all zip codes in Texas or a
bordering state: zips\_texas\_borderstates\_centroids, using the zip
code prefixes to make these subsets. How many unique zip codes are in
each of these
subsets?}\label{partner-2-create-two-geodataframes-as-subsets-of-zips_all_centroids.-first-create-all-zip-codes-in-texas-zips_texas_centroids.-then-create-all-zip-codes-in-texas-or-a-bordering-state-zips_texas_borderstates_centroids-using-the-zip-code-prefixes-to-make-these-subsets.-how-many-unique-zip-codes-are-in-each-of-these-subsets}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{texas\_prefixes }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}75\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}76\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}77\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}78\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}79\textquotesingle{}}\NormalTok{]}

\NormalTok{border\_states\_prefixes }\OperatorTok{=}\NormalTok{ \{}\StringTok{\textquotesingle{}New Mexico\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}87\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}88\textquotesingle{}}\NormalTok{],}\StringTok{\textquotesingle{}Oklahoma\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}73\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}74\textquotesingle{}}\NormalTok{],}\StringTok{\textquotesingle{}Arkansas\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}71\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}72\textquotesingle{}}\NormalTok{],}\StringTok{\textquotesingle{}Louisiana\textquotesingle{}}\NormalTok{: [}\StringTok{\textquotesingle{}70\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}71\textquotesingle{}}\NormalTok{]\}}

\NormalTok{zips\_texas\_centroids }\OperatorTok{=}\NormalTok{ zips\_all\_centroids[zips\_all\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].}\BuiltInTok{str}\NormalTok{[:}\DecValTok{2}\NormalTok{].isin(texas\_prefixes)]}

\NormalTok{all\_prefixes }\OperatorTok{=}\NormalTok{ texas\_prefixes }\OperatorTok{+}\NormalTok{ [prefix }\ControlFlowTok{for}\NormalTok{ state\_prefixes }\KeywordTok{in}\NormalTok{ border\_states\_prefixes.values() }\ControlFlowTok{for}\NormalTok{ prefix }\KeywordTok{in}\NormalTok{ state\_prefixes]}

\NormalTok{zips\_texas\_borderstates\_centroids }\OperatorTok{=}\NormalTok{ zips\_all\_centroids[zips\_all\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].}\BuiltInTok{str}\NormalTok{[:}\DecValTok{2}\NormalTok{].isin(all\_prefixes)]}

\NormalTok{texas\_unique\_zips }\OperatorTok{=}\NormalTok{ zips\_texas\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].nunique()}
\NormalTok{border\_states\_unique\_zips }\OperatorTok{=}\NormalTok{ zips\_texas\_borderstates\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].nunique()}


\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f\textquotesingle{}there are }\SpecialCharTok{\{}\NormalTok{texas\_unique\_zips}\SpecialCharTok{\}}\SpecialStringTok{ unique zipcodes in Texas\textquotesingle{}}\NormalTok{)}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f\textquotesingle{}there are }\SpecialCharTok{\{}\NormalTok{border\_states\_unique\_zips}\SpecialCharTok{\}}\SpecialStringTok{ unique zips in Texas and bordering states\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
there are 1935 unique zipcodes in Texas
there are 4057 unique zips in Texas and bordering states
\end{verbatim}

\paragraph{3.(Partner 2) Then create a subset of
zips\_texas\_borderstates\_centroids that contains only the zip codes
with at least 1 hospital in 2016. Call the resulting GeoDataFrame
zips\_withhospital\_centroids What kind of merge did you decide to do,
and what variable are you merging
on?}\label{partner-2-then-create-a-subset-of-zips_texas_borderstates_centroids-that-contains-only-the-zip-codes-with-at-least-1-hospital-in-2016.-call-the-resulting-geodataframe-zips_withhospital_centroids-what-kind-of-merge-did-you-decide-to-do-and-what-variable-are-you-merging-on}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zips\_texas\_borderstates\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].head}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
<bound method NDFrame.head of 8870     70003
8871     70030
8872     70032
8873     70036
8874     70038
         ...  
32917    78261
32918    78368
32919    78412
32920    78557
32921    78586
Name: ZCTA5, Length: 4057, dtype: object>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{hospitals\_2016 }\OperatorTok{=}\NormalTok{ df[(df[}\StringTok{\textquotesingle{}year\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{2016}\NormalTok{) }\OperatorTok{\&}\NormalTok{ (df[}\StringTok{\textquotesingle{}PGM\_TRMNTN\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{==} \DecValTok{0}\NormalTok{)]}
\NormalTok{hospitals\_2016[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ hospitals\_2016[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].astype(}\BuiltInTok{int}\NormalTok{).astype(}\BuiltInTok{str}\NormalTok{)}

\NormalTok{zips\_texas\_borderstates\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ zips\_texas\_borderstates\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{]}

\NormalTok{zip\_codes\_with\_hospitals }\OperatorTok{=}\NormalTok{ hospitals\_2016[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].unique()}

\NormalTok{zips\_withhospital\_centroids }\OperatorTok{=}\NormalTok{ zips\_texas\_borderstates\_centroids[zips\_texas\_borderstates\_centroids[}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{].isin(zip\_codes\_with\_hospitals)]}

\NormalTok{zips\_withhospital\_centroids.plot()}
\end{Highlighting}
\end{Shaded}

\includegraphics{ps4_files/figure-pdf/cell-23-output-1.pdf}

\begin{Shaded}
\begin{Highlighting}[]
\BuiltInTok{len}\NormalTok{(zips\_withhospital\_centroids)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
448
\end{verbatim}

I decided to first filter for active hospitals in the 2016 df, then I
made the zipswithhospitals by filtering the
zips\_texas\_border\_state\_centroid df zips by whether the zips are in
the active hospital zip.

\paragraph{4. (Partner 2) For each zip code in zips\_texas\_centroids,
calculate the distance to the nearest zip code with at least one
hospital in
zips\_withhospital\_centroids.}\label{partner-2-for-each-zip-code-in-zips_texas_centroids-calculate-the-distance-to-the-nearest-zip-code-with-at-least-one-hospital-in-zips_withhospital_centroids.}

\begin{verbatim}
a. This is a computationally-intensive join. Before attempting to do the entire join, subset to 10 zip codes in zips_texas_centroids and try the join. How long did it take? Approximately how long do you estimate the entire procedure will take?
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ time}
\ImportTok{from}\NormalTok{ shapely }\ImportTok{import}\NormalTok{ Point}
\NormalTok{subset\_texas\_centroids }\OperatorTok{=}\NormalTok{ zips\_texas\_centroids.head(}\DecValTok{10}\NormalTok{)}

\NormalTok{start\_time }\OperatorTok{=}\NormalTok{ time.time()}

\NormalTok{distances }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ \_, texas\_zip }\KeywordTok{in}\NormalTok{ subset\_texas\_centroids.iterrows():}
\NormalTok{    min\_distance }\OperatorTok{=}\NormalTok{ zips\_withhospital\_centroids.distance(texas\_zip.geometry).}\BuiltInTok{min}\NormalTok{()}
\NormalTok{    distances.append(min\_distance)}


\NormalTok{end\_time }\OperatorTok{=}\NormalTok{ time.time()}

\NormalTok{time\_taken\_subset }\OperatorTok{=}\NormalTok{ end\_time }\OperatorTok{{-}}\NormalTok{ start\_time}
\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f\textquotesingle{}Time taken for 10 ZIP codes was }\SpecialCharTok{\{}\NormalTok{time\_taken\_subset}\SpecialCharTok{:.2f\}}\SpecialStringTok{ seconds\textquotesingle{}}\NormalTok{)}

\NormalTok{full\_data\_estimate }\OperatorTok{=}\NormalTok{ (time\_taken\_subset }\OperatorTok{/} \DecValTok{10}\NormalTok{) }\OperatorTok{*} \BuiltInTok{len}\NormalTok{(zips\_texas\_centroids)}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f\textquotesingle{}it will take approx. }\SpecialCharTok{\{}\NormalTok{full\_data\_estimate}\SpecialCharTok{\}}\SpecialStringTok{ seconds to join the whole df\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Time taken for 10 ZIP codes was 0.09 seconds
it will take approx. 16.603901624679565 seconds to join the whole df
\end{verbatim}

\begin{verbatim}
b. Now try doing the full calculation and time how long it takes. How close is it to your estimation?
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{start\_time\_full }\OperatorTok{=}\NormalTok{ time.time()}

\NormalTok{full\_distances }\OperatorTok{=}\NormalTok{ []}
\ControlFlowTok{for}\NormalTok{ \_, texas\_zip }\KeywordTok{in}\NormalTok{ zips\_texas\_centroids.iterrows():}
\NormalTok{    min\_distance }\OperatorTok{=}\NormalTok{ zips\_withhospital\_centroids.distance(texas\_zip.geometry).}\BuiltInTok{min}\NormalTok{()}
\NormalTok{    full\_distances.append(min\_distance)}


\NormalTok{end\_time\_full }\OperatorTok{=}\NormalTok{ time.time()}

\NormalTok{actual\_time\_full }\OperatorTok{=}\NormalTok{ end\_time\_full }\OperatorTok{{-}}\NormalTok{ start\_time\_full}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f\textquotesingle{}the whole calculation took }\SpecialCharTok{\{}\NormalTok{actual\_time\_full}\SpecialCharTok{\}}\SpecialStringTok{ this is very close to my calculation\textquotesingle{}}\NormalTok{)}

\NormalTok{zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ full\_distances}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
the whole calculation took 15.393359661102295 this is very close to my calculation
\end{verbatim}

\begin{verbatim}
c. Look into the .prj file and report which unit it is in. Convert the given unit to miles, using an appropriate conversion you find online (estimates are okay).
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{with} \BuiltInTok{open}\NormalTok{(}\StringTok{"gz\_2010\_us\_860\_00\_500k.prj"}\NormalTok{, }\StringTok{\textquotesingle{}r\textquotesingle{}}\NormalTok{) }\ImportTok{as} \BuiltInTok{file}\NormalTok{:}
\NormalTok{    prj\_text }\OperatorTok{=} \BuiltInTok{file}\NormalTok{.read()}

\BuiltInTok{print}\NormalTok{(prj\_text) }\CommentTok{\#\# units are in degrees}

\NormalTok{zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\_miles\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\textquotesingle{}}\NormalTok{] }\OperatorTok{*} \DecValTok{69}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
GEOGCS["GCS_North_American_1983",DATUM["D_North_American_1983",SPHEROID["GRS_1980",6378137,298.257222101]],PRIMEM["Greenwich",0],UNIT["Degree",0.017453292519943295]]
\end{verbatim}

\paragraph{5.(Partner 2) Calculate the average distance to the nearest
hospital for each zip code in
Texas.}\label{partner-2-calculate-the-average-distance-to-the-nearest-hospital-for-each-zip-code-in-texas.}

\begin{verbatim}
a. What unit is this in
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#Its in degrees}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
b. Report the average distance in miles. Does this value make sense?
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{average\_distance\_miles }\OperatorTok{=}\NormalTok{ zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\_miles\textquotesingle{}}\NormalTok{].mean()}

\BuiltInTok{print}\NormalTok{(}\SpecialStringTok{f\textquotesingle{}The average distance is }\SpecialCharTok{\{}\NormalTok{average\_distance\_miles}\SpecialCharTok{:.2f\}}\SpecialStringTok{ miles.\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
The average distance is 14.56 miles.
\end{verbatim}

\begin{verbatim}
c. Map the value for each zip code
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\textquotesingle{}}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
9207     0.000000
9208     0.167651
9209     0.110844
9210     0.337251
9211     0.219909
           ...   
32917    0.110636
32918    0.313242
32919    0.000000
32920    0.058567
32921    0.155733
Name: nearest_hospital_distance, Length: 1935, dtype: float64
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\_miles\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ pd.to\_numeric(zips\_texas\_centroids[}\StringTok{\textquotesingle{}nearest\_hospital\_distance\_miles\textquotesingle{}}\NormalTok{], errors}\OperatorTok{=}\StringTok{\textquotesingle{}coerce\textquotesingle{}}\NormalTok{)}

\NormalTok{zips\_texas\_centroids.plot(}
\NormalTok{    column}\OperatorTok{=}\StringTok{\textquotesingle{}nearest\_hospital\_distance\_miles\textquotesingle{}}\NormalTok{, }
\NormalTok{    cmap}\OperatorTok{=}\StringTok{\textquotesingle{}coolwarm\textquotesingle{}}\NormalTok{, markersize }\OperatorTok{=} \DecValTok{2}\NormalTok{,}
\NormalTok{    legend}\OperatorTok{=}\VariableTok{True}\NormalTok{,legend\_kwds}\OperatorTok{=}\NormalTok{\{}\StringTok{\textquotesingle{}label\textquotesingle{}}\NormalTok{: }\StringTok{"Distance to Nearest Hospital"}\NormalTok{\})}
\end{Highlighting}
\end{Shaded}

\includegraphics{ps4_files/figure-pdf/cell-31-output-1.pdf}

\subsection{Effects of closures on access in Texas (15
pts)}\label{effects-of-closures-on-access-in-texas-15-pts}

\paragraph{1. (Partner 1) Using the corrected hospital closures dataset
from the first section, create a list of directly affected zip codes in
Texas-- that is, those with at least one closure in 2016-2019. Display a
table of the number of zip codes vs.~the number of closures they
experienced.}\label{partner-1-using-the-corrected-hospital-closures-dataset-from-the-first-section-create-a-list-of-directly-affected-zip-codes-in-texas-that-is-those-with-at-least-one-closure-in-2016-2019.-display-a-table-of-the-number-of-zip-codes-vs.-the-number-of-closures-they-experienced.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df5 }\OperatorTok{=}\NormalTok{ df[df[}\StringTok{\textquotesingle{}TRMNTN\_EXPRTN\_DT\textquotesingle{}}\NormalTok{].notna()]}
\NormalTok{df5[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df5[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].astype(}\BuiltInTok{int}\NormalTok{)}
\NormalTok{df5[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ df5[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].astype(}\BuiltInTok{str}\NormalTok{)}
\NormalTok{Q5\_1\_closures }\OperatorTok{=}\NormalTok{ df5[}\StringTok{\textquotesingle{}ZIP\_CD\textquotesingle{}}\NormalTok{].value\_counts().rename(}\StringTok{"number\_closures"}\NormalTok{)}
\NormalTok{Q5\_1\_closures}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
ZIP_CD
79902    26
70115    24
71101    24
80218    24
90301    20
         ..
41041     1
70503     1
20707     1
49058     1
77090     1
Name: number_closures, Length: 3403, dtype: int64
\end{verbatim}

\paragraph{2.(Partner 1) Plot a choropleth of which Texas zip codes were
directly affected by a closure in 2016-2019-- there was at least one
closure within the zip code. How many directly affected zip codes are
there in
Texas?}\label{partner-1-plot-a-choropleth-of-which-texas-zip-codes-were-directly-affected-by-a-closure-in-2016-2019-there-was-at-least-one-closure-within-the-zip-code.-how-many-directly-affected-zip-codes-are-there-in-texas}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Q5\_1\_closures }\OperatorTok{=}\NormalTok{ Q5\_1\_closures.reset\_index()}
\NormalTok{Q5\_1\_closures.columns }\OperatorTok{=}\NormalTok{ [}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}number\_closures\textquotesingle{}}\NormalTok{]}

\NormalTok{zips\_texas5\_2 }\OperatorTok{=}\NormalTok{ zips\_texas}
\NormalTok{zips\_texas5\_2 }\OperatorTok{=}\NormalTok{ zips\_texas5\_2.merge(Q5\_1\_closures, on}\OperatorTok{=}\StringTok{\textquotesingle{}ZCTA5\textquotesingle{}}\NormalTok{, how}\OperatorTok{=}\StringTok{\textquotesingle{}left\textquotesingle{}}\NormalTok{)}
\NormalTok{zips\_texas5\_2[}\StringTok{\textquotesingle{}number\_closures\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ zips\_texas5\_2[}\StringTok{\textquotesingle{}number\_closures\textquotesingle{}}\NormalTok{].fillna(}\DecValTok{0}\NormalTok{)}
\BuiltInTok{print}\NormalTok{((zips\_texas5\_2[}\StringTok{\textquotesingle{}number\_closures\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{).}\BuiltInTok{sum}\NormalTok{())}

\CommentTok{\#\#\#plot}
\NormalTok{zips\_texas5\_2.plot(column}\OperatorTok{=}\StringTok{"number\_closures"}\NormalTok{, legend}\OperatorTok{=}\VariableTok{True}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
334
\end{verbatim}

\includegraphics{ps4_files/figure-pdf/cell-33-output-2.pdf}

There are 334 Zip codes in Texas that were affected by at least 1
closure between 2017-2019

\paragraph{3. (Partner 1) Then identify all the indirectly affected zip
codes: Texas zip codes within a 10-mile radius of the directly affected
zip codes. To do so, first create a GeoDataFrame of the directly
affected zip codes. Then create a 10-mile buffer around them. Then, do a
spatial join with the overall Texas zip code shapefile. How many
indirectly affected zip codes are there in
Texas?}\label{partner-1-then-identify-all-the-indirectly-affected-zip-codes-texas-zip-codes-within-a-10-mile-radius-of-the-directly-affected-zip-codes.-to-do-so-first-create-a-geodataframe-of-the-directly-affected-zip-codes.-then-create-a-10-mile-buffer-around-them.-then-do-a-spatial-join-with-the-overall-texas-zip-code-shapefile.-how-many-indirectly-affected-zip-codes-are-there-in-texas}

\begin{Shaded}
\begin{Highlighting}[]
\ImportTok{import}\NormalTok{ matplotlib.pyplot }\ImportTok{as}\NormalTok{ plt}
\CommentTok{\#\#\# gdf of directly affected zips}
\NormalTok{zips\_texas5\_3 }\OperatorTok{=}\NormalTok{ zips\_texas5\_2[zips\_texas5\_2[}\StringTok{\textquotesingle{}number\_closures\textquotesingle{}}\NormalTok{] }\OperatorTok{\textgreater{}} \DecValTok{0}\NormalTok{]}
\CommentTok{\#\#\# create buffer}
\NormalTok{zips\_texas5\_3.crs }\CommentTok{\#check distance units.   }\AlertTok{\#\#\#}\CommentTok{ 1 degree latitude =69 miles, therefore 1 mile =  1/69 degrees = 0.01449}
\NormalTok{zips\_texas5\_3[}\StringTok{\textquotesingle{}geometry\textquotesingle{}}\NormalTok{] }\OperatorTok{=}\NormalTok{ zips\_texas5\_3.geometry.}\BuiltInTok{buffer}\NormalTok{(}\FloatTok{0.01449}\NormalTok{)}

\CommentTok{\#\#\#join}
\NormalTok{zips\_texas5\_3\_joined }\OperatorTok{=}\NormalTok{ gpd.sjoin(zips\_texas5\_2, zips\_texas5\_3, how}\OperatorTok{=}\StringTok{\textquotesingle{}inner\textquotesingle{}}\NormalTok{)}

\NormalTok{zips\_texas5\_3\_joined[}\StringTok{\textquotesingle{}ZCTA5\_left\textquotesingle{}}\NormalTok{].nunique()}

\CommentTok{\#asked chatgpt "after conducting a spacial left join, how to find number of overlapping areas, given a buffer on the right geometries"}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
1518
\end{verbatim}

There are 1518 total affected zip codes, and 1184 directly affected zip
codes in Texas.

\paragraph{4.(Partner 1) Make a choropleth plot of the Texas zip codes
with a different color for each of the 3 categories: directly affected
by a closure, within 10 miles of closure but not directly affected, or
not
affected.}\label{partner-1-make-a-choropleth-plot-of-the-texas-zip-codes-with-a-different-color-for-each-of-the-3-categories-directly-affected-by-a-closure-within-10-miles-of-closure-but-not-directly-affected-or-not-affected.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#df\_test = pd.DataFrame(zips\_texas5\_3\_joined)}
\end{Highlighting}
\end{Shaded}

\subsection{Reflecting on the exercise (10
pts)}\label{reflecting-on-the-exercise-10-pts}

\paragraph{(Partner 1) The ``first-pass'' method we're using to address
incorrectly identified closures in the data is imperfect. Can you think
of some potential issues that could arise still and ways to do a better
job at confirming hospital
closures?}\label{partner-1-the-first-pass-method-were-using-to-address-incorrectly-identified-closures-in-the-data-is-imperfect.-can-you-think-of-some-potential-issues-that-could-arise-still-and-ways-to-do-a-better-job-at-confirming-hospital-closures}

\paragraph{(Partner 2) Consider the way we are identifying zip codes
affected by closures. How well does this reflect changes in
zip-code-level access to hospitals? Can you think of some ways to
improve this
measure?}\label{partner-2-consider-the-way-we-are-identifying-zip-codes-affected-by-closures.-how-well-does-this-reflect-changes-in-zip-code-level-access-to-hospitals-can-you-think-of-some-ways-to-improve-this-measure}




\end{document}
